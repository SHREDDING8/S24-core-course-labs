# Kubernetes ConfigMaps

## Upgrade Application for Persistence

### Python volume for visits counter

```shell
(venv) shredding@SHREDDING-2 S24-core-course-labs % curl 0.0.0.0:8080/visits
{"visits":0}                                                                                                                                                          
(venv) shredding@SHREDDING-2 S24-core-course-labs % curl 0.0.0.0:8080/moscow-time 
"2024-04-23T22:15:10.144695+03:00"                                                                                                                                    
(venv) shredding@SHREDDING-2 S24-core-course-labs % curl 0.0.0.0:8080/visits     
{"visits":1} 
```

## Mount a Config File

### Verify configMap

```shell
(venv) shredding@SHREDDING-2 S24-core-course-labs %  kubectl get configmap app-python-configmap -o yaml
apiVersion: v1
data:
  config.json: |
    {
      "key_one": "secret_one",
      "key_two": "secret_two"
    }
  env-var: ENV_CONFIG_VAR
kind: ConfigMap
metadata:
  annotations:
    meta.helm.sh/release-name: python
    meta.helm.sh/release-namespace: default
  creationTimestamp: "2024-04-23T22:30:45Z"
  labels:
    app.kubernetes.io/managed-by: Helm
  name: app-python-configmap
  namespace: default
  resourceVersion: "113937"
  uid: 93621de2-aa0f-4389-9d29-dedebbd2abf0
```

### Retrieve the list of pods

```shell
(venv) shredding@SHREDDING-2 S24-core-course-labs % kubectl get po                                     
NAME                                   READY   STATUS      RESTARTS        AGE
python-app-python-854646957c-96nrx     1/1     Running     0               54s
python-app-python-854646957c-jdtcc     1/1     Running     0               54s
python-app-python-854646957c-xt5ph     1/1     Running     0               54s

```

### Check the ConfigMap inside the pod

```shell
(venv) shredding@SHREDDING-2 k8s %  kubectl exec python-app-python-854646957c-96nrx -- cat config_map/config.json
{
  "key_one": "secret_one",
  "key_two": "secret_two"
}
```

## Utilize ConfigMap via environment variables

### Run env command inside the container

```shell
(venv) shredding@SHREDDING-2 k8s % kubectl exec python-app-python-854646957c-96nrx -- env | grep CONFIG_MAP_VAR
CONFIG_MAP_VAR=ENV_CONFIG_VAR
```